<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8.4 - Branching e Merging</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <h1>8.4 - Branching e Merging</h1>
        
        <div class="teoria">
            <h2>Cos'√® un Branch?</h2>
            <p>Un <strong>branch</strong> √® un puntatore mobile a un commit. Ti permette di sviluppare features, fix bugs, o sperimentare in isolamento dal codice principale.</p>
            
            <div class="codice">
<pre><strong>Concetti Chiave:</strong>

main branch (o master)
  ‚Üì
  ‚Ä¢ ‚Üê HEAD punta al branch corrente
  ‚îÇ
  ‚Ä¢ ‚Üê commit precedente
  ‚îÇ
  ‚Ä¢ ‚Üê commit ancora prima

# HEAD = puntatore al branch corrente
# Branch = puntatore leggero a un commit
# main = branch principale (default)</pre>
            </div>
            
            <h3>Perch√© Usare i Branch?</h3>
            <ul>
                <li><strong>Isolamento:</strong> Lavora su feature senza impattare main</li>
                <li><strong>Sperimentazione:</strong> Prova cose nuove senza rischi</li>
                <li><strong>Collaborazione:</strong> Ogni developer su proprio branch</li>
                <li><strong>Review:</strong> Code review prima di merge in main</li>
                <li><strong>Hotfix:</strong> Fix urgenti in produzione senza WIP</li>
            </ul>
        </div>
        
        <div class="teoria">
            <h2>Creare e Gestire Branch</h2>
            
            <div class="codice">
<pre># Lista tutti i branch:
git branch
# Output:
# * main        ‚Üê asterisco indica branch corrente
#   feature-login
#   bugfix-navbar

# Lista branch con ultimo commit:
git branch -v

# Lista branch locali e remoti:
git branch -a

# Crea nuovo branch:
git branch feature-auth

# Crea branch e switch subito:
git checkout -b feature-auth
# Oppure (Git 2.23+):
git switch -c feature-auth

# Switch a branch esistente:
git checkout main
# Oppure (Git 2.23+):
git switch main

# Rinomina branch corrente:
git branch -m nuovo-nome

# Rinomina branch specifico:
git branch -m vecchio-nome nuovo-nome

# Cancella branch (se gi√† merged):
git branch -d feature-auth

# Cancella branch forzatamente (anche se non merged):
git branch -D feature-auth</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Differenza tra checkout e switch</h2>
            
            <div class="codice">
<pre><strong>git checkout (comando storico, fa troppe cose):</strong>
git checkout branch-name     # Cambia branch
git checkout -- file.txt     # Discarta modifiche file
git checkout commit-hash     # Va a commit specifico
git checkout -b new-branch   # Crea e switch

<strong>git switch (Git 2.23+, solo per branch):</strong>
git switch branch-name       # Cambia branch
git switch -c new-branch     # Crea e switch
git switch -                 # Torna a branch precedente

<strong>git restore (Git 2.23+, solo per file):</strong>
git restore file.txt         # Discarta modifiche
git restore --staged file.txt # Unstage file

# üí° Tip: Usa switch/restore invece di checkout (pi√π chiaro)</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Workflow con Branch</h2>
            
            <div class="codice">
<pre># 1. Sei su main, tutto committato:
git status  # working tree clean

# 2. Crea branch per nuova feature:
git switch -c feature-dark-mode

# 3. Lavora sulla feature:
echo "dark mode code" &gt; darkmode.js
git add darkmode.js
git commit -m "feat: implementato dark mode"

# 4. Altro lavoro:
echo "more dark mode" &gt;&gt; darkmode.js
git commit -am "feat: aggiunto toggle dark mode"

# 5. Feature completa, torna a main:
git switch main

# 6. Merge feature in main:
git merge feature-dark-mode

# 7. Cancella branch (ora inutile):
git branch -d feature-dark-mode

# 8. Ora main ha la feature!</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Tipi di Merge</h2>
            
            <h3>1. Fast-Forward Merge</h3>
            <div class="codice">
<pre># Situazione: main non ha nuovi commit da quando hai creato il branch

main:      A ‚Üê B
                ‚Üë
feature:        C ‚Üê D

# Merge fast-forward:
git switch main
git merge feature

main:      A ‚Üê B ‚Üê C ‚Üê D
                       ‚Üë
feature:              (deleted)

# Git sposta semplicemente il puntatore main avanti
# Nessun commit di merge creato
# Storia lineare</pre>
            </div>
            
            <h3>2. Three-Way Merge</h3>
            <div class="codice">
<pre># Situazione: main ha nuovi commit da quando hai creato il branch

main:      A ‚Üê B ‚Üê C
                ‚Üì
feature:        D ‚Üê E

# Merge three-way:
git switch main
git merge feature

main:      A ‚Üê B ‚Üê C ‚Üê‚îÄ‚îê
                ‚Üì      M  ‚Üê merge commit
feature:        D ‚Üê E ‚îÄ‚îò

# Git crea un commit di merge con due parent
# Storia non lineare (visualizza il branching)</pre>
            </div>
            
            <h3>3. Squash Merge</h3>
            <div class="codice">
<pre># Combina tutti i commit del branch in uno solo:
git merge --squash feature-auth
git commit -m "feat: implementata autenticazione"

# Utile per:
# - Pulire storia da commit WIP
# - Raggruppare feature completa in un commit
# - Mantenere main history pulita</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Merge Conflicts</h2>
            <p>Un <strong>conflitto</strong> accade quando Git non riesce ad unire automaticamente le modifiche.</p>
            
            <div class="codice">
<pre># Esempio: stesso file modificato in entrambi i branch
git merge feature-auth
# Auto-merging index.html
# CONFLICT (content): Merge conflict in index.html
# Automatic merge failed; fix conflicts and then commit the result.

# Status mostra conflitto:
git status
# On branch main
# You have unmerged paths.
# Unmerged paths:
#   (use "git add &lt;file&gt;..." to mark resolution)
#       both modified:   index.html

# File conflittato contiene markers:
cat index.html
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
&lt;h1&gt;Welcome to Main&lt;/h1&gt;
=======
&lt;h1&gt;Welcome to Feature&lt;/h1&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature-auth

# Markers spiegazione:
# &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD = tua versione (branch corrente)
# ======= = separatore
# &gt;&gt;&gt;&gt;&gt;&gt;&gt; feature-auth = versione del branch che mergi</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Risolvere Conflicts</h2>
            
            <div class="codice">
<pre><strong>Metodo 1: Manualmente</strong>
# 1. Apri file in conflitto:
code index.html

# 2. Modifica file, scegli quale versione tenere:
# Prima (conflitto):
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
&lt;h1&gt;Welcome to Main&lt;/h1&gt;
=======
&lt;h1&gt;Welcome to Feature&lt;/h1&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature-auth

# Dopo (risolto):
&lt;h1&gt;Welcome to Main with Feature&lt;/h1&gt;

# 3. Stage file risolto:
git add index.html

# 4. Completa merge:
git commit -m "Merge feature-auth: risolti conflitti"

<strong>Metodo 2: Accetta una versione completamente</strong>
# Accetta versione main (ours):
git checkout --ours index.html
git add index.html

# Accetta versione feature (theirs):
git checkout --theirs index.html
git add index.html

# Completa merge:
git commit

<strong>Metodo 3: Merge Tool</strong>
# Usa tool grafico (VS Code, Meld, P4Merge):
git mergetool

# VS Code mostra:
# - Accept Current Change (ours)
# - Accept Incoming Change (theirs)
# - Accept Both Changes
# - Compare Changes

<strong>Abortire Merge</strong>
# Se vuoi annullare il merge:
git merge --abort
# Torna allo stato pre-merge</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Branch Naming Conventions</h2>
            
            <div class="codice">
<pre><strong>Convenzioni Comuni:</strong>

feature/nome-feature      # Nuove feature
  feature/user-auth
  feature/dark-mode
  
bugfix/nome-bug          # Bug fix
  bugfix/login-redirect
  bugfix/navbar-mobile
  
hotfix/nome-urgente      # Fix urgente produzione
  hotfix/security-patch
  hotfix/payment-crash
  
release/versione         # Preparation release
  release/v1.2.0
  release/2024-01
  
chore/nome-task         # Maintenance tasks
  chore/update-deps
  chore/refactor-api

<strong>Best Practices Naming:</strong>
‚úÖ feature/add-user-authentication
‚úÖ bugfix/fix-mobile-menu
‚úÖ hotfix/critical-security-patch

‚ùå temp                    # Poco descrittivo
‚ùå my-branch              # Non professionale
‚ùå test                   # Ambiguo
‚ùå fix                    # Troppo generico</pre>
            </div>
        </div>
        
        <div class="teoria">
            <h2>Git Flow - Strategia di Branching</h2>
            
            <div class="codice">
<pre><strong>Branch Permanenti:</strong>
main (produzione)    # Solo codice stabile
develop (staging)    # Prossima release

<strong>Branch Temporanei:</strong>
feature/*           # Da develop, merge in develop
release/*           # Da develop, merge in main e develop
hotfix/*            # Da main, merge in main e develop

<strong>Workflow:</strong>
1. Sviluppo normale:
   develop ‚Üí feature/xyz ‚Üí develop

2. Preparazione release:
   develop ‚Üí release/v1.0 ‚Üí main + develop

3. Bug urgente produzione:
   main ‚Üí hotfix/critical ‚Üí main + develop

<strong>Comandi Esempio:</strong>
# Inizia feature:
git checkout develop
git checkout -b feature/user-profile

# Finisci feature:
git checkout develop
git merge --no-ff feature/user-profile
git branch -d feature/user-profile

# Crea release:
git checkout develop
git checkout -b release/1.0.0
# ... test, bug fix ...
git checkout main
git merge --no-ff release/1.0.0
git tag v1.0.0
git checkout develop
git merge --no-ff release/1.0.0</pre>
            </div>
        </div>
        
        <div class="best-practices">
            <h2>‚úÖ Best Practices - Branching</h2>
            
            <h3>‚úÖ DO - Fare:</h3>
            <ul>
                <li>Crea branch per ogni feature/bugfix</li>
                <li>Usa naming conventions consistenti</li>
                <li>Mantieni branch piccoli e focalizzati</li>
                <li>Merge spesso (evita long-lived branches)</li>
                <li>Cancella branch dopo merge</li>
                <li>Committa su main solo codice testato</li>
                <li>Usa pull requests per code review</li>
                <li>Mantieni main sempre deployable</li>
            </ul>
            
            <h3>‚ùå DON'T - Evitare:</h3>
            <ul>
                <li>Non committare direttamente su main (usa branch)</li>
                <li>Non tenere branch aperti per settimane</li>
                <li>Non creare branch da branch da branch (mantieni semplice)</li>
                <li>Non mergiare branch con conflitti non risolti</li>
                <li>Non accumulare troppi branch inutilizzati</li>
                <li>Non usare nomi branch generici (test, temp, my-branch)</li>
            </ul>
        </div>
        
        <div class="navigazione">
            <a href="lezione-8-3.html" class="btn-nav">‚Üê Precedente: Add, Commit</a>
            <a href="index.html" class="btn-nav">üìö Indice</a>
            <a href="lezione-8-5.html" class="btn-nav">Prossima: Log e History ‚Üí</a>
        </div>
    </div>
</body>
</html>
