<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5.1 - JavaScript ES6+</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>5.1 - JavaScript ES6+</h1>
            <p>Funzionalità moderne di JavaScript per lo sviluppo web</p>
        </div>

        <div class="teoria">
            <h2>Obiettivi</h2>
            <p>Padroneggiare le funzionalità moderne di JavaScript necessarie per lavorare con TypeScript e React.</p>
        </div>

        <h2>1. Let e Const</h2>
        
        <div class="teoria">
            <h3>Perché Non Usare var</h3>
            <pre><code>// ❌ Vecchio modo con var (problemi di scope)
var nome = "Mario";
if (true) {
    var nome = "Luigi";  // Sovrascrive la variabile esterna!
}
console.log(nome);  // "Luigi"

// ✅ Modo moderno con let
let cognome = "Rossi";
if (true) {
    let cognome = "Bianchi";  // Variabile diversa (block scope)
}
console.log(cognome);  // "Rossi"

// ✅ const per valori immutabili
const PI = 3.14159;
// PI = 3.14;  // ❌ Errore: non puoi riassegnare const

// ⚠️ Ma puoi modificare oggetti e array!
const utente = { nome: "Marco" };
utente.nome = "Paolo";  // ✅ OK
utente.eta = 25;        // ✅ OK
// utente = {};         // ❌ Errore: non puoi riassegnare</code></pre>

            <h3>Regola Pratica</h3>
            <ul>
                <li>Usa <strong>const</strong> di default (99% dei casi)</li>
                <li>Usa <strong>let</strong> solo se devi riassegnare la variabile</li>
                <li>Non usare mai <strong>var</strong></li>
            </ul>
        </div>

        <h2>2. Arrow Functions (5 min)</h2>

        <div class="teoria">
            <h3>Sintassi Concisa</h3>
            <pre><code>// Funzione tradizionale
function somma(a, b) {
    return a + b;
}

// ✅ Arrow function
const somma = (a, b) => {
    return a + b;
};

// ✅ Versione ultra-concisa (return implicito)
const somma = (a, b) => a + b;

// Con un solo parametro puoi omettere le parentesi
const doppio = x => x * 2;

// Senza parametri
const saluta = () => console.log("Ciao!");</code></pre>

            <h3>This Binding Automatico</h3>
            <pre><code>// Problema con funzioni tradizionali
const persona = {
    nome: "Maria",
    amici: ["Anna", "Luca"],
    stampaAmici: function() {
        this.amici.forEach(function(amico) {
            // ❌ this qui è undefined!
            console.log(this.nome + " è amica di " + amico);
        });
    }
};

// ✅ Soluzione con arrow function
const persona = {
    nome: "Maria",
    amici: ["Anna", "Luca"],
    stampaAmici: function() {
        this.amici.forEach(amico => {
            // ✅ this è automaticamente quello dell'oggetto persona
            console.log(this.nome + " è amica di " + amico);
        });
    }
};</code></pre>
        </div>

        <h2>3. Template Literals (3 min)</h2>

        <div class="teoria">
            <pre><code>// ❌ Concatenazione vecchio stile
const nome = "Carlo";
const eta = 30;
const messaggio = "Mi chiamo " + nome + " e ho " + eta + " anni";

// ✅ Template literals con backtick `
const messaggio = `Mi chiamo ${nome} e ho ${eta} anni`;

// Espressioni dentro ${}
const prezzo = 100;
console.log(`Totale con IVA: ${prezzo * 1.22}€`);

// Multilinea senza \n
const html = `
    <div>
        <h1>${nome}</h1>
        <p>Età: ${eta}</p>
    </div>
`;</code></pre>
        </div>

        <h2>4. Destructuring (5 min)</h2>

        <div class="teoria">
            <h3>Destrutturazione di Array</h3>
            <pre><code>const colori = ["rosso", "verde", "blu"];

// ❌ Modo vecchio
const primo = colori[0];
const secondo = colori[1];

// ✅ Destructuring
const [primo, secondo] = colori;
console.log(primo);   // "rosso"
console.log(secondo); // "verde"

// Saltare elementi
const [, , terzo] = colori;
console.log(terzo);  // "blu"

// Valori di default
const [a, b, c, d = "giallo"] = colori;
console.log(d);  // "giallo"</code></pre>

            <h3>Destrutturazione di Oggetti</h3>
            <pre><code>const utente = {
    nome: "Laura",
    eta: 28,
    citta: "Roma"
};

// ✅ Destructuring
const { nome, eta } = utente;
console.log(nome);  // "Laura"
console.log(eta);   // 28

// Rinominare variabili
const { nome: nomeUtente, eta: etaUtente } = utente;

// Valori di default
const { nome, professione = "Sviluppatore" } = utente;

// Destructuring nei parametri di funzione
function saluta({ nome, citta }) {
    console.log(`Ciao ${nome} da ${citta}`);
}
saluta(utente);  // "Ciao Laura da Roma"</code></pre>
        </div>

        <h2>5. Spread e Rest Operator (7 min)</h2>

        <div class="teoria">
            <h3>Spread Operator (...)</h3>
            <pre><code>// Copiare array
const numeri = [1, 2, 3];
const copia = [...numeri];

// Concatenare array
const arr1 = [1, 2];
const arr2 = [3, 4];
const uniti = [...arr1, ...arr2];  // [1, 2, 3, 4]

// Copiare oggetti
const persona = { nome: "Luca", eta: 25 };
const copia = { ...persona };

// Unire oggetti (merge)
const datiBase = { nome: "Luca" };
const datiExtra = { eta: 25, citta: "Milano" };
const completo = { ...datiBase, ...datiExtra };

// Sovrascrivere proprietà
const aggiornato = { ...persona, eta: 26 };  // eta diventa 26</code></pre>

            <h3>Rest Parameter (...)</h3>
            <pre><code>// Raccogliere argomenti in un array
function somma(...numeri) {
    return numeri.reduce((tot, n) => tot + n, 0);
}
console.log(somma(1, 2, 3, 4));  // 10

// Combinare con parametri normali
function presenta(saluto, ...nomi) {
    return `${saluto} ${nomi.join(", ")}!`;
}
presenta("Ciao", "Anna", "Marco", "Luigi");  // "Ciao Anna, Marco, Luigi!"

// Destructuring con rest
const [primo, secondo, ...altri] = [1, 2, 3, 4, 5];
console.log(altri);  // [3, 4, 5]

const { nome, ...resto } = { nome: "Mario", eta: 30, citta: "Roma" };
console.log(resto);  // { eta: 30, citta: "Roma" }</code></pre>
        </div>

        <h2>6. Array Methods (7 min)</h2>

        <div class="teoria">
            <pre><code>const numeri = [1, 2, 3, 4, 5];

// map: trasforma ogni elemento
const doppi = numeri.map(n => n * 2);
// [2, 4, 6, 8, 10]

// filter: filtra elementi
const pari = numeri.filter(n => n % 2 === 0);
// [2, 4]

// reduce: riduce ad un singolo valore
const somma = numeri.reduce((totale, n) => totale + n, 0);
// 15

// find: trova primo elemento che soddisfa condizione
const maggioreDi3 = numeri.find(n => n > 3);
// 4

// some: verifica se almeno uno soddisfa condizione
const haPari = numeri.some(n => n % 2 === 0);
// true

// every: verifica se tutti soddisfano condizione
const tuttiPositivi = numeri.every(n => n > 0);
// true</code></pre>

            <h3>Esempio Reale: Elaborare Dati</h3>
            <pre><code>const prodotti = [
    { nome: "Laptop", prezzo: 1000, categoria: "tech" },
    { nome: "Mouse", prezzo: 25, categoria: "tech" },
    { nome: "Libro", prezzo: 15, categoria: "libri" }
];

// Filtra prodotti tech e calcola totale
const totaleTech = prodotti
    .filter(p => p.categoria === "tech")
    .reduce((tot, p) => tot + p.prezzo, 0);
// 1025

// Aumenta prezzi del 10%
const conAumento = prodotti.map(p => ({
    ...p,
    prezzo: p.prezzo * 1.1
}));</code></pre>
        </div>

        <h2>7. Promises e Async/Await (8 min)</h2>

        <div class="teoria">
            <h3>Promises</h3>
            <pre><code>// Promise: operazione asincrona che può avere successo o fallire
function caricaDati() {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const successo = true;
            if (successo) {
                resolve({ id: 1, nome: "Dati caricati" });
            } else {
                reject("Errore nel caricamento");
            }
        }, 1000);
    });
}

// Usare la promise con .then() e .catch()
caricaDati()
    .then(dati => {
        console.log(dati);
        return dati.id;
    })
    .then(id => {
        console.log("ID:", id);
    })
    .catch(errore => {
        console.error(errore);
    });</code></pre>

            <h3>Async/Await (Sintassi Moderna)</h3>
            <pre><code>// ✅ Molto più leggibile!
async function mostraDati() {
    try {
        const dati = await caricaDati();
        console.log(dati);
        
        const altriDati = await caricaAltriDati(dati.id);
        console.log(altriDati);
        
    } catch (errore) {
        console.error("Errore:", errore);
    }
}

// Esempio con fetch API
async function getUtenti() {
    try {
        const response = await fetch('https://api.example.com/users');
        const utenti = await response.json();
        return utenti;
    } catch (errore) {
        console.error("Errore API:", errore);
    }
}

// Eseguire più promise in parallelo
async function caricaTutto() {
    const [utenti, prodotti, ordini] = await Promise.all([
        fetch('/api/users').then(r => r.json()),
        fetch('/api/products').then(r => r.json()),
        fetch('/api/orders').then(r => r.json())
    ]);
    
    return { utenti, prodotti, ordini };
}</code></pre>
        </div>

        <h2>8. Moduli ES6 (3 min)</h2>

        <div class="teoria">
            <pre><code>// file: utils.js
export const PI = 3.14159;

export function somma(a, b) {
    return a + b;
}

export class Calcolatrice {
    moltiplica(a, b) {
        return a * b;
    }
}

// Export default (uno per file)
export default function principale() {
    console.log("Funzione principale");
}

// =====================================

// file: main.js
// Import named exports
import { PI, somma, Calcolatrice } from './utils.js';

// Import default
import principale from './utils.js';

// Import tutto
import * as Utils from './utils.js';

// Import con alias
import { somma as add } from './utils.js';</code></pre>
        </div>

        <h2>9. Optional Chaining e Nullish Coalescing (2 min)</h2>

        <div class="teoria">
            <pre><code>// Optional Chaining (?.)
const utente = {
    nome: "Mario",
    indirizzo: {
        citta: "Roma"
    }
};

// ❌ Vecchio modo
const cap = utente && utente.indirizzo && utente.indirizzo.cap;

// ✅ Nuovo modo
const cap = utente?.indirizzo?.cap;  // undefined (senza errori)

// Con funzioni
utente.saluta?.();  // Chiama solo se esiste

// Con array
const primo = array?.[0];

// =====================================

// Nullish Coalescing (??)
const valore = null;
const risultato = valore ?? "default";  // "default"

// Differenza con ||
const zero = 0;
console.log(zero || 100);   // 100 (perché 0 è falsy)
console.log(zero ?? 100);   // 0 (perché 0 non è null/undefined)

const testo = "";
console.log(testo || "default");   // "default"
console.log(testo ?? "default");   // "" (stringa vuota è valida)</code></pre>
        </div>

        <div class="teoria">
            <h2>Riepilogo JavaScript ES6+</h2>
            <table>
                <tr>
                    <th>Concetto</th>
                    <th>Quando Usarlo</th>
                </tr>
                <tr>
                    <td>const/let</td>
                    <td>Sempre (const di default)</td>
                </tr>
                <tr>
                    <td>Arrow functions</td>
                    <td>Callback, array methods</td>
                </tr>
                <tr>
                    <td>Template literals</td>
                    <td>Stringhe con variabili</td>
                </tr>
                <tr>
                    <td>Destructuring</td>
                    <td>Estrarre dati da oggetti/array</td>
                </tr>
                <tr>
                    <td>Spread/Rest</td>
                    <td>Copiare, unire, raccogliere</td>
                </tr>
                <tr>
                    <td>map/filter/reduce</td>
                    <td>Trasformare array</td>
                </tr>
                <tr>
                    <td>async/await</td>
                    <td>Operazioni asincrone</td>
                </tr>
                <tr>
                    <td>Optional chaining</td>
                    <td>Accesso sicuro a proprietà</td>
                </tr>
            </table>
        </div>

        <div class="teoria">
            <h2>Navigazione</h2>
            <ul>
                <li><a href="index.html">← Torna all'Indice Lezione 5</a></li>
                <li><a href="lezione-5-2.html">5.2 - TypeScript Essenziale →</a></li>
            </ul>
        </div>
    </div>
</body>
</html>